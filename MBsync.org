#+title: Mbsync
#+PROPERTY: header-args:conf :results silent

I use =mbsync= (from the isync suite) to sync mail from my IMAP server
to my local machine.

* Personal account

To rotate password:
: security delete-generic-password -s mbsync-gandi-password
: security add-generic-password -a stig@brautaset.org -s mbsync-gandi-password -w APP-SPECIFIC-PASSWORD

#+BEGIN_SRC conf :tangle (if (string-match "margil" (system-name)) "~/.mbsyncrc" "no")
IMAPStore remote
Host mail.gandi.net
User stig@brautaset.org
SSLType IMAPS
AuthMechs LOGIN
PassCmd "/usr/bin/security find-generic-password -s mbsync-gandi-password -w"
PipelineDepth 1

MaildirStore local
Subfolders Verbatim
Path ~/.mail/
Inbox ~/.mail/INBOX

Channel inbox
Far :remote:
Near :local:
SyncState *
Expunge Both

Channel sent
Far :remote:Sent
Near :local:Sent
SyncState *
Expunge Both

Channel archive
Far :remote:Archive
Near :local:Archive
SyncState *
Expunge Both

Channel trash
Far :remote:Trash
Near :local:Trash
SyncState *
Expunge Both

Channel spam
Far :remote:Junk
Near :local:Spam
SyncState *
Expunge Both

Channel lists
Far :remote:
Near :local:
Patterns org-mode
SyncState *
Expunge Both
#+END_SRC

* Work account

To rotate password:
: security delete-generic-password -s mbsync-gmail-password
: security add-generic-password -a stig@circleci.com -s mbsync-gmail-password -w APP-SPECIFIC-PASSWORD

#+begin_src conf :tangle (if (string-match "pearmain" (system-name)) "~/.mbsyncrc" "no")
IMAPStore remote
Host imap.gmail.com
User stig@circleci.com
PassCmd "/usr/bin/security find-generic-password -s mbsync-gmail-password -w"
SSLType IMAPS
AuthMechs PLAIN
# The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
# CertificateFile /etc/ssl/certs/ca-certificates.crt
#CertificateFile ~/.cert/imap.gmail.com.pem
#CertificateFile ~/.cert/Equifax_Secure_CA.pem

MaildirStore local
Subfolders Verbatim
Path ~/.mail/
Inbox ~/.mail/INBOX

Channel inbox
Far :remote:
Near :local:
SyncState *
Expunge Both

Channel sent
Far :remote:"[Gmail]/Sent Mail"
Near :local:Sent
SyncState *
Expunge Both

Channel archive
Far :remote:History
Near :local:Archive
SyncState *
Expunge Both

Channel trash
Far :remote:"[Gmail]/Trash"
Near :local:Trash
SyncState *
Expunge Both

Channel spam
Far :remote:"[Gmail]/Spam"
Near :local:Spam
SyncState *
Expunge Both
#+end_src
