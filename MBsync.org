#+title: Mbsync
#+PROPERTY: header-args:conf :results silent

I use =mbsync= (from the isync suite) to sync mail from my IMAP server
to my local machine.

* Personal account

To rotate password:
: security delete-generic-password -s mbsync-gandi-password
: security add-generic-password -a stig@brautaset.org -s mbsync-gandi-password -w APP-SPECIFIC-PASSWORD

#+BEGIN_SRC conf :tangle (if (string-match "margil" (system-name)) "~/.mbsyncrc" "no")
IMAPStore remote
Host mail.gandi.net
User stig@brautaset.org
SSLType IMAPS
AuthMechs LOGIN
PassCmd "security find-generic-password -s mbsync-gandi-password -w"
PipelineDepth 1

MaildirStore local
Subfolders Verbatim
Path ~/.mail/
Inbox ~/.mail/INBOX

Channel inbox
Master :remote:
Slave :local:
SyncState *

Channel sent
Master :remote:Sent
Slave :local:Sent
SyncState *

Channel archive
Master :remote:Archive
Slave :local:Archive
SyncState *

Channel trash
Master :remote:Trash
Slave :local:Trash
SyncState *

Channel spam
Master :remote:Junk
Slave :local:Spam
SyncState *

Channel lists
Master :remote:
Slave :local:
Patterns org-mode tuls
SyncState *
#+END_SRC

* Work account

To rotate password:
: security delete-generic-password -s mbsync-gmail-password
: security add-generic-password -a stig@circleci.com -s mbsync-gmail-password -w APP-SPECIFIC-PASSWORD

#+begin_src conf :tangle (if (string-match "pearmain" (system-name)) "~/.mbsyncrc" "no")
IMAPStore remote
Host imap.gmail.com
User stig@circleci.com
PassCmd "security find-generic-password -s mbsync-gmail-password -w"
SSLType IMAPS
AuthMechs PLAIN
# The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
# CertificateFile /etc/ssl/certs/ca-certificates.crt
#CertificateFile ~/.cert/imap.gmail.com.pem
#CertificateFile ~/.cert/Equifax_Secure_CA.pem

MaildirStore local
Subfolders Verbatim
Path ~/.mail/
Inbox ~/.mail/INBOX

Channel inbox
Master :remote:
Slave :local:
SyncState *

Channel sent
Master :remote:[Gmail]/Sent
Slave :local:Sent
SyncState *

Channel archive
Master :remote:Archive
Slave :local:Archive
SyncState *

Channel trash
Master :remote:[Gmail]/Trash
Slave :local:Trash
SyncState *

Channel spam
Master :remote:[Gmail]/Spam
Slave :local:Spam
SyncState *
#+end_src
